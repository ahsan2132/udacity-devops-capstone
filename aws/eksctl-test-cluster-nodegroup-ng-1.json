{"AWSTemplateFormatVersion":"2010-09-09","Description":"EKS nodes (AMI family: AmazonLinux2, SSH access: true, private networking: false) [created and managed by eksctl]","Mappings":{"ServicePrincipalPartitionMap":{"aws":{"EC2":"ec2.amazonaws.com","EKS":"eks.amazonaws.com","EKSFargatePods":"eks-fargate-pods.amazonaws.com"},"aws-cn":{"EC2":"ec2.amazonaws.com.cn","EKS":"eks.amazonaws.com","EKSFargatePods":"eks-fargate-pods.amazonaws.com"},"aws-us-gov":{"EC2":"ec2.amazonaws.com","EKS":"eks.amazonaws.com","EKSFargatePods":"eks-fargate-pods.amazonaws.com"}}},"Resources":{"EgressInterCluster":{"Type":"AWS::EC2::SecurityGroupEgress","Properties":{"Description":"Allow control plane to communicate with worker nodes in group ng-1 (kubelet and workload TCP ports)","DestinationSecurityGroupId":{"Ref":"SG"},"FromPort":1025,"GroupId":{"Fn::ImportValue":"eksctl-test-cluster-cluster::SecurityGroup"},"IpProtocol":"tcp","ToPort":65535}},"EgressInterClusterAPI":{"Type":"AWS::EC2::SecurityGroupEgress","Properties":{"Description":"Allow control plane to communicate with worker nodes in group ng-1 (workloads using HTTPS port, commonly used with extension API servers)","DestinationSecurityGroupId":{"Ref":"SG"},"FromPort":443,"GroupId":{"Fn::ImportValue":"eksctl-test-cluster-cluster::SecurityGroup"},"IpProtocol":"tcp","ToPort":443}},"IngressInterCluster":{"Type":"AWS::EC2::SecurityGroupIngress","Properties":{"Description":"Allow worker nodes in group ng-1 to communicate with control plane (kubelet and workload TCP ports)","FromPort":1025,"GroupId":{"Ref":"SG"},"IpProtocol":"tcp","SourceSecurityGroupId":{"Fn::ImportValue":"eksctl-test-cluster-cluster::SecurityGroup"},"ToPort":65535}},"IngressInterClusterAPI":{"Type":"AWS::EC2::SecurityGroupIngress","Properties":{"Description":"Allow worker nodes in group ng-1 to communicate with control plane (workloads using HTTPS port, commonly used with extension API servers)","FromPort":443,"GroupId":{"Ref":"SG"},"IpProtocol":"tcp","SourceSecurityGroupId":{"Fn::ImportValue":"eksctl-test-cluster-cluster::SecurityGroup"},"ToPort":443}},"IngressInterClusterCP":{"Type":"AWS::EC2::SecurityGroupIngress","Properties":{"Description":"Allow control plane to receive API requests from worker nodes in group ng-1","FromPort":443,"GroupId":{"Fn::ImportValue":"eksctl-test-cluster-cluster::SecurityGroup"},"IpProtocol":"tcp","SourceSecurityGroupId":{"Ref":"SG"},"ToPort":443}},"NodeGroup":{"Type":"AWS::AutoScaling::AutoScalingGroup","Properties":{"DesiredCapacity":"2","LaunchTemplate":{"LaunchTemplateName":{"Fn::Sub":"${AWS::StackName}"},"Version":{"Fn::GetAtt":"NodeGroupLaunchTemplate.LatestVersionNumber"}},"MaxSize":"2","MinSize":"2","Tags":[{"Key":"Name","PropagateAtLaunch":"true","Value":"test-cluster-ng-1-Node"},{"Key":"kubernetes.io/cluster/test-cluster","PropagateAtLaunch":"true","Value":"owned"}],"VPCZoneIdentifier":{"Fn::Split":[",",{"Fn::ImportValue":"eksctl-test-cluster-cluster::SubnetsPublic"}]}},"UpdatePolicy":{"AutoScalingRollingUpdate":{"MaxBatchSize":"1","MinInstancesInService":"0"}}},"NodeGroupLaunchTemplate":{"Type":"AWS::EC2::LaunchTemplate","Properties":{"LaunchTemplateData":{"BlockDeviceMappings":[{"DeviceName":"/dev/xvda","Ebs":{"Encrypted":false,"VolumeSize":80,"VolumeType":"gp2"}}],"IamInstanceProfile":{"Arn":{"Fn::GetAtt":"NodeInstanceProfile.Arn"}},"ImageId":"ami-03cb83c4dfe25bd99","InstanceType":"t2.small","KeyName":"testKP","MetadataOptions":{"HttpPutResponseHopLimit":2},"NetworkInterfaces":[{"DeviceIndex":0,"Groups":[{"Fn::ImportValue":"eksctl-test-cluster-cluster::SharedNodeSecurityGroup"},{"Ref":"SG"}]}],"UserData":"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"},"LaunchTemplateName":{"Fn::Sub":"${AWS::StackName}"}}},"NodeInstanceProfile":{"Type":"AWS::IAM::InstanceProfile","Properties":{"Path":"/","Roles":[{"Ref":"NodeInstanceRole"}]}},"NodeInstanceRole":{"Type":"AWS::IAM::Role","Properties":{"AssumeRolePolicyDocument":{"Statement":[{"Action":["sts:AssumeRole"],"Effect":"Allow","Principal":{"Service":[{"Fn::FindInMap":["ServicePrincipalPartitionMap",{"Ref":"AWS::Partition"},"EC2"]}]}}],"Version":"2012-10-17"},"ManagedPolicyArns":[{"Fn::Sub":"arn:${AWS::Partition}:iam::aws:policy/AmazonEC2ContainerRegistryReadOnly"},{"Fn::Sub":"arn:${AWS::Partition}:iam::aws:policy/AmazonEKSWorkerNodePolicy"},{"Fn::Sub":"arn:${AWS::Partition}:iam::aws:policy/AmazonEKS_CNI_Policy"}],"Path":"/"}},"SG":{"Type":"AWS::EC2::SecurityGroup","Properties":{"GroupDescription":"Communication between the control plane and worker nodes in group ng-1","Tags":[{"Key":"kubernetes.io/cluster/test-cluster","Value":"owned"},{"Key":"Name","Value":{"Fn::Sub":"${AWS::StackName}/SG"}}],"VpcId":{"Fn::ImportValue":"eksctl-test-cluster-cluster::VPC"}}},"SSHIPv4":{"Type":"AWS::EC2::SecurityGroupIngress","Properties":{"CidrIp":"0.0.0.0/0","Description":"Allow SSH access to worker nodes in group ng-1","FromPort":22,"GroupId":{"Ref":"SG"},"IpProtocol":"tcp","ToPort":22}},"SSHIPv6":{"Type":"AWS::EC2::SecurityGroupIngress","Properties":{"CidrIpv6":"::/0","Description":"Allow SSH access to worker nodes in group ng-1","FromPort":22,"GroupId":{"Ref":"SG"},"IpProtocol":"tcp","ToPort":22}}},"Outputs":{"FeatureLocalSecurityGroup":{"Value":true},"FeaturePrivateNetworking":{"Value":false},"FeatureSharedSecurityGroup":{"Value":true},"InstanceProfileARN":{"Export":{"Name":{"Fn::Sub":"${AWS::StackName}::InstanceProfileARN"}},"Value":{"Fn::GetAtt":"NodeInstanceProfile.Arn"}},"InstanceRoleARN":{"Export":{"Name":{"Fn::Sub":"${AWS::StackName}::InstanceRoleARN"}},"Value":{"Fn::GetAtt":"NodeInstanceRole.Arn"}}}}
